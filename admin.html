<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1020" />
  <title>Lumina ‚Äî Admin</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Onest:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="bg-aurora" aria-hidden="true"></div>

  <!-- AppShell -->
  <header class="appbar">
    <a class="appbarLeft" href="./index.html" aria-label="Volver a tienda">
      <span class="icon">‚Üê</span>
      <span class="appbarTitle">Admin</span>
    </a>

    <div class="appbarRight">
      <span class="tiny muted" id="adminEmail">‚Äî</span>
      <button class="btn btnGhost btnSm" id="logoutBtn" type="button">Salir</button>
    </div>
  </header>

  <main class="container adminContainer">
    <!-- Login -->
    <section id="loginView" class="card cardPad loginCard">
      <h1 class="h2">Iniciar sesi√≥n</h1>
      <p class="muted">Solo administradores autorizados.</p>

      <form id="loginForm" class="form">
        <label class="field">
          <span class="fieldLabel">Email</span>
          <input class="input" id="email" type="email" autocomplete="email" required />
        </label>

        <label class="field">
          <span class="fieldLabel">Contrase√±a</span>
          <input class="input" id="password" type="password" autocomplete="current-password" required />
        </label>

        <button class="btn btnPrimary" type="submit">Entrar</button>
      </form>
    </section>

    <!-- Admin -->
    <section id="adminView" hidden>
      <section class="adminTop">
        <div class="adminTitleBlock">
          <h2 class="h2">Productos</h2>
          <p class="muted tiny">Crear, editar y eliminar ‚Äî con imagen WebP optimizada.</p>
        </div>
        <button class="btn btnPrimary" id="newProductBtn" type="button">+ Nuevo</button>
      </section>

      <!-- Editor -->
      <section id="editor" class="card cardPad" hidden>
        <div class="editorTop">
          <h3 class="h3" id="editorTitle">Nuevo producto</h3>
          <button class="iconBtn" id="closeEditor" aria-label="Cerrar editor">‚úï</button>
        </div>

        <form id="productForm" class="form">
          <input type="hidden" id="productId" />

          <div class="formGrid">
            <label class="field">
              <span class="fieldLabel">Nombre</span>
              <input class="input" id="pName" required />
            </label>

            <label class="field">
              <span class="fieldLabel">Categor√≠a</span>
              <select class="select" id="pCategory" required>
                <option value="manillas">Manillas</option>
                <option value="pulseras">Pulseras</option>
                <option value="anillos">Anillos</option>
                <option value="collares">Collares</option>
              </select>
            </label>

            <label class="field span2">
              <span class="fieldLabel">Descripci√≥n</span>
              <textarea class="textarea" id="pDesc" rows="3"></textarea>
            </label>

            <label class="field">
              <span class="fieldLabel">Precio base (COP)</span>
              <input class="input" id="pBasePrice" type="number" inputmode="numeric" min="0" step="1000" required />
            </label>

            <label class="field">
              <span class="fieldLabel">Descuento % (0-100)</span>
              <input class="input" id="pDiscount" type="number" inputmode="numeric" min="0" max="100" step="1" />
            </label>

            <label class="field inline">
              <input id="pFeatured" type="checkbox" class="checkbox" />
              <span>Destacado</span>
            </label>

            <label class="field span2">
              <span class="fieldLabel">Colores (separados por coma)</span>
              <input class="input" id="pColors" placeholder="Ej: Negro, Dorado, Plateado" />
              <span class="tiny muted">Se guarda como text[] en Postgres.</span>
            </label>

            <label class="field span2">
              <span class="fieldLabel">Tallas (una por l√≠nea: Etiqueta, Extra)</span>
              <textarea class="textarea" id="pSizes" rows="3" placeholder="√önica, 0&#10;M, 5000"></textarea>
              <span class="tiny muted">Si dejas vac√≠o, se crea ‚Äú√önica, 0‚Äù.</span>
            </label>

            <label class="field span2">
              <span class="fieldLabel">Imagen</span>
              <input class="input" id="pImage" type="file" accept="image/*" />
              <div class="tiny muted">
                Se comprime en el navegador: WebP (q‚âà0.75), m√°x 1200px ancho.
              </div>
              <div class="previewRow">
                <img id="imgPreview" class="previewImg" alt="Vista previa" />
                <div class="tiny muted" id="imgInfo">‚Äî</div>
              </div>
            </label>
          </div>

          <div class="editorActions">
            <button class="btn btnGhost" id="deleteBtn" type="button" hidden>Eliminar</button>
            <button class="btn btnPrimary" type="submit" id="saveBtn">Guardar</button>
          </div>
        </form>
      </section>

      <!-- Listado -->
      <section class="card cardPad">
        <div class="listHeader adminListHeader">
          <div class="tiny" id="adminMeta">‚Äî</div>
          <button class="btn btnSoft btnSm" id="refreshBtn" type="button">Actualizar</button>
        </div>

        <div id="adminList" class="adminList" aria-label="Listado admin"></div>

        <div id="adminEmpty" class="emptyState" hidden>
          <div class="emptyIcon" aria-hidden="true">üì¶</div>
          <div class="emptyTitle">No hay productos</div>
          <div class="emptySub">Crea el primero con ‚ÄúNuevo‚Äù.</div>
        </div>
      </section>
    </section>
  </main>

  <div id="toastHost" class="toastHost" aria-live="polite" aria-relevant="additions"></div>

  <script type="module" src="./supabaseClient.js"></script>
  <script type="module" src="./admin.js"></script>
</body>
  </html>
