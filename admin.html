<!doctype html>
<html lang="es-CO">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin | Accesorios</title>
  <meta name="description" content="Panel admin para gestionar productos." />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="adminShell">
    <header class="adminTop" role="banner">
      <div class="inner">
        <div class="row" style="gap:10px;">
          <span class="logo" aria-label="Admin">
            <span class="dot" aria-hidden="true"></span>
            <strong>ADMIN</strong>
            <span class="muted tiny">Accesorios</span>
          </span>
        </div>

        <div class="row" style="gap:10px;">
          <span id="adminEmail" class="muted small">—</span>
          <button id="logoutBtn" class="btn hidden" aria-label="Cerrar sesión">Salir</button>
        </div>
      </div>
    </header>

    <main class="adminGrid" role="main">
      <!-- Login -->
      <section id="loginPanel" class="panel" aria-label="Login admin">
        <h2>Iniciar sesión</h2>
        <p class="muted" style="margin-top:-6px;">
          Acceso solo para administradores. Usa email/contraseña (Supabase Auth).
        </p>

        <div class="formGrid">
          <div>
            <label class="muted tiny" for="loginEmail">Email</label>
            <input id="loginEmail" class="input" type="email" placeholder="admin@correo.com" aria-label="Email" />
          </div>
          <div>
            <label class="muted tiny" for="loginPass">Contraseña</label>
            <input id="loginPass" class="input" type="password" placeholder="••••••••" aria-label="Contraseña" />
          </div>
          <button id="loginBtn" class="btn primary block" aria-label="Entrar">Entrar</button>
          <p class="muted tiny" style="margin:0;">
            Si inicias sesión y no tienes <span class="kbd">is_admin</span>, no podrás usar el panel.
          </p>
        </div>
      </section>

      <!-- Editor -->
      <section id="editorPanel" class="panel hidden" aria-label="Editor de productos">
        <h2 id="editorTitle">Crear producto</h2>
        <p class="muted" style="margin-top:-6px;">
          Sube imagen, configura tallas con extra, colores, descuentos y destacado.
        </p>

        <div class="formGrid">
          <div class="grid2">
            <div>
              <label class="muted tiny" for="nameInput">Nombre</label>
              <input id="nameInput" class="input" placeholder="Ej: Pulsera de cuero premium" aria-label="Nombre" />
            </div>
            <div>
              <label class="muted tiny" for="categoryInput">Categoría</label>
              <select id="categoryInput" class="select" aria-label="Categoría">
                <option value="manillas">Manillas</option>
                <option value="pulseras">Pulseras</option>
                <option value="anillos">Anillos</option>
                <option value="collares">Collares</option>
              </select>
            </div>
          </div>

          <div>
            <label class="muted tiny" for="descInput">Descripción</label>
            <textarea id="descInput" class="textarea" placeholder="Detalles del producto, material, estilo..." aria-label="Descripción"></textarea>
          </div>

          <div class="grid2">
            <div>
              <label class="muted tiny" for="basePriceInput">Precio base (COP)</label>
              <input id="basePriceInput" class="input" inputmode="numeric" placeholder="Ej: 45000" aria-label="Precio base" />
            </div>
            <div>
              <label class="muted tiny" for="discountInput">Descuento (%)</label>
              <input id="discountInput" class="input" inputmode="numeric" placeholder="Ej: 15" aria-label="Descuento" />
            </div>
          </div>

          <div class="grid2">
            <div class="row" style="align-items:center; justify-content:space-between;">
              <div>
                <div class="muted tiny">Destacado</div>
                <div class="muted small">Aparece primero en la tienda.</div>
              </div>
              <label class="row" style="gap:10px;">
                <input id="featuredInput" type="checkbox" aria-label="Destacado" />
                <span class="badge featured">Sí</span>
              </label>
            </div>

            <div>
              <div class="muted tiny">Colores (enter para agregar)</div>
              <div id="colorsPills" class="pillInput" aria-label="Colores disponibles">
                <input id="colorAddInput" placeholder="Ej: Negro" aria-label="Agregar color" />
              </div>
              <div class="helper">Se guardan como <span class="kbd">text[]</span>.</div>
            </div>
          </div>

          <div>
            <div class="muted tiny">Tallas (enter para agregar)</div>
            <div class="helper" style="margin-bottom:8px;">
              Formato: <span class="kbd">Etiqueta, Extra</span> → ejemplo: <span class="kbd">M, 5000</span>
            </div>
            <div id="sizesPills" class="pillInput" aria-label="Tallas disponibles">
              <input id="sizeAddInput" placeholder="Ej: S, 0" aria-label="Agregar talla" />
            </div>
          </div>

          <div class="grid2">
            <div>
              <div class="muted tiny">Imagen (JPG/PNG/WEBP)</div>
              <input id="imageInput" class="input" type="file" accept="image/png,image/jpeg,image/webp" aria-label="Subir imagen" />
              <div class="helper">La imagen se sube a Supabase Storage (bucket: product-images).</div>
            </div>
            <div>
              <div class="muted tiny">Previsualización</div>
              <div class="preview" aria-label="Vista previa">
                <img id="imagePreview" alt="Previsualización" class="hidden" />
                <span id="previewHint" class="muted small">Sin imagen</span>
              </div>
            </div>
          </div>

          <div class="row wrap">
            <button id="saveBtn" class="btn primary" aria-label="Guardar producto">Guardar</button>
            <button id="cancelEditBtn" class="btn ghost hidden" aria-label="Cancelar edición">Cancelar</button>
            <span id="savingHint" class="muted small"></span>
          </div>
        </div>
      </section>

      <!-- List -->
      <section id="listPanel" class="panel hidden" aria-label="Lista de productos">
        <div class="row spread">
          <h2 style="margin:0;">Productos</h2>
          <button id="refreshBtn" class="btn" aria-label="Actualizar lista">Actualizar</button>
        </div>
        <div class="hr"></div>
        <div id="productsList" class="table" aria-live="polite"></div>
      </section>
    </main>
  </div>

  <div id="toasts" class="toasts" aria-live="polite" aria-atomic="true"></div>

  <script type="module" src="./admin.js"></script>
</body>
</html>